import type { NextPage } from "next";
import Router from "next/router";
import { useCallback, useEffect, useReducer } from "react";

import Button from "@/ui/components/Button";
import Input from "@/ui/components/Input/Input";
import Modal from "@/ui/components/Modal/Modal";
import { Page } from "@/ui/components/Page/Page";

import { authPageReducer, initialAuthPageState } from "@/ui/modules/Auth/state";

import { useStore } from "@/ui/state/Store";

import { uiApiClient } from "@/ui/external";

import { cb } from "@/utils/cb";


const Home: NextPage = () => {
  const [state, change] = useReducer(authPageReducer, initialAuthPageState);
  const { login } = uiApiClient.auth();
  const {
    state: { user },
  } = useStore();

  const initLogin = useCallback(() => {
    if (state.email && state.emailValid) {
      change(true);
      login(state.email).finally(cb(change, false));
    }
  }, [login, state]);

  useEffect(() => {
    !!user && Router.push("/");
  }, [user]);

  return (
    <>
      <Page>
        <div className="flex h-full md:flex-wrap ">
          <div className="w-1/2 lg:w-4/12 flex items-center justify-center bg-[#141620] md:w-full">
            <div className="logo md:w-1/2 md:w-48 xl:w-auto md:mb-5 md:h-96 flex items-center justify-center">
              <figure>
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="720"
                  height="1080"
                  fill="none"
                  viewBox="0 0 720 1080"
                >
                  <g clipPath="url(#clip0_33_581)" opacity="0.9">
                    <path fill="#EFF0F6" d="M0 0H720V1080H0z"></path>
                    <g clipPath="url(#clip1_33_581)">
                      <path
                        fill="#EFF0F6"
                        d="M0 0H720V1080H0z"
                        transform="translate(0 -.196)"
                      ></path>
                      <rect
                        width="382.91"
                        height="260.409"
                        fill="#F0A108"
                        rx="10"
                        transform="matrix(-.96593 .25882 -.7071 -.7071 377.633 1043.43)"
                      ></rect>
                      <rect
                        width="382.91"
                        height="260.409"
                        fill="#0576F0"
                        rx="10"
                        transform="matrix(.96593 -.25882 -.7071 -.7071 117.125 984.423)"
                      ></rect>
                      <rect
                        width="382.91"
                        height="260.409"
                        fill="#D857C9"
                        rx="10"
                        transform="matrix(-.96593 .25882 .7071 .7071 243.921 780.291)"
                      ></rect>
                      <rect
                        width="382.91"
                        height="260.409"
                        fill="#F0A108"
                        rx="10"
                        transform="matrix(.96593 -.25882 .7071 .7071 341.321 22.142)"
                      ></rect>
                      <rect
                        width="382.91"
                        height="260.409"
                        fill="#0576F0"
                        rx="10"
                        transform="matrix(-.96593 .25882 .7071 .7071 601.828 81.15)"
                      ></rect>
                      <rect
                        width="382.91"
                        height="260.409"
                        fill="#D857C9"
                        rx="10"
                        transform="matrix(.96593 -.25882 -.7071 -.7071 475.032 285.282)"
                      ></rect>
                      <path
                        fill="#000"
                        d="M225.492 511.222h-.888a10.38 10.38 0 01-2.294 2.963 12.274 12.274 0 01-2.961 2.074 12.702 12.702 0 01-3.33 1.185 13.99 13.99 0 01-3.405.445c-2.467 0-4.761-.42-6.882-1.259a16.96 16.96 0 01-5.625-3.63c-1.579-1.58-2.837-3.531-3.775-5.852-.888-2.37-1.332-5.062-1.332-8.074v-1.185c0-2.963.469-5.605 1.406-7.926.938-2.37 2.196-4.346 3.775-5.926a15.666 15.666 0 015.551-3.704c2.121-.839 4.366-1.259 6.734-1.259 2.517 0 4.86.568 7.031 1.704 2.221 1.086 3.923 2.79 5.107 5.111h.888V465h5.773v51.852h-5.773v-5.63zm-12.285 1.185c1.726 0 3.33-.321 4.81-.963a11.217 11.217 0 003.849-2.74c1.135-1.185 2.023-2.593 2.664-4.223.642-1.679.962-3.53.962-5.555v-.889c0-1.975-.32-3.778-.962-5.407-.641-1.679-1.529-3.111-2.664-4.297a11.043 11.043 0 00-3.923-2.74 11.045 11.045 0 00-4.736-1.037c-1.727 0-3.356.321-4.885.963a11.98 11.98 0 00-3.923 2.74c-1.085 1.185-1.949 2.593-2.59 4.222-.592 1.63-.888 3.433-.888 5.408v1.185c0 2.074.296 3.926.888 5.556.641 1.629 1.505 3.037 2.59 4.222a12.563 12.563 0 003.923 2.667c1.48.592 3.108.888 4.885.888zM250.308 500.259c.148 3.655 1.283 6.593 3.405 8.815 2.121 2.222 5.082 3.333 8.881 3.333 1.727 0 3.232-.197 4.515-.592 1.283-.395 2.368-.938 3.256-1.63.938-.691 1.678-1.481 2.221-2.37a13.595 13.595 0 001.406-2.963l5.477 1.481c-1.037 3.408-2.961 6.198-5.773 8.371-2.763 2.123-6.513 3.185-11.25 3.185-2.615 0-5.033-.445-7.253-1.333-2.171-.939-4.046-2.247-5.625-3.926-1.579-1.679-2.812-3.679-3.7-6-.888-2.321-1.332-4.889-1.332-7.704v-1.778c0-2.568.444-4.963 1.332-7.185.937-2.222 2.22-4.123 3.848-5.704a17.18 17.18 0 015.699-3.778c2.22-.938 4.613-1.407 7.179-1.407 3.01 0 5.6.568 7.771 1.704 2.221 1.086 4.021 2.444 5.403 4.074 1.431 1.629 2.467 3.407 3.108 5.333.691 1.926 1.037 3.704 1.037 5.334v4.74h-29.605zm12.286-15.703c-1.628 0-3.158.271-4.589.814a11.54 11.54 0 00-3.7 2.149 12.322 12.322 0 00-2.59 3.333c-.642 1.234-1.061 2.592-1.259 4.074h23.684c-.099-1.58-.494-3.012-1.184-4.296a9.853 9.853 0 00-2.591-3.26c-1.036-.889-2.245-1.58-3.626-2.074a11.826 11.826 0 00-4.145-.74zM316.94 516.852h-11.397l-12.804-36.741h6.809l11.249 34.074h.889l11.249-34.074h6.809l-12.804 36.741zM204.695 572.926c0 1.778.74 3.136 2.221 4.074 1.529.938 4.292 1.556 8.289 1.852 4.292.346 7.549 1.383 9.769 3.111 2.27 1.679 3.405 4.148 3.405 7.407v.445c0 1.778-.37 3.383-1.11 4.815-.691 1.382-1.678 2.568-2.961 3.555-1.233.988-2.763 1.729-4.588 2.222-1.777.544-3.726.815-5.847.815-2.862 0-5.329-.37-7.401-1.111-2.023-.79-3.726-1.802-5.107-3.037-1.332-1.284-2.344-2.716-3.035-4.296-.69-1.63-1.085-3.259-1.184-4.889l5.477-1.333c.247 2.814 1.332 5.086 3.257 6.814 1.924 1.679 4.49 2.519 7.697 2.519 2.713 0 4.884-.519 6.513-1.556 1.677-1.086 2.516-2.592 2.516-4.518 0-2.074-.814-3.556-2.442-4.445-1.629-.889-4.268-1.456-7.92-1.703-4.243-.297-7.499-1.284-9.769-2.963-2.27-1.679-3.404-4.124-3.404-7.334v-.444c0-1.728.37-3.235 1.11-4.519a10.108 10.108 0 012.96-3.333 14.271 14.271 0 014.293-2 18.233 18.233 0 014.958-.667c2.418 0 4.54.346 6.365 1.037 1.826.642 3.356 1.507 4.589 2.593 1.234 1.037 2.171 2.247 2.812 3.63.691 1.382 1.135 2.765 1.333 4.148l-5.477 1.333c-.247-2.37-1.209-4.222-2.887-5.555-1.628-1.334-3.774-2-6.438-2a12.45 12.45 0 00-3.035.37 8.06 8.06 0 00-2.516.963 5.344 5.344 0 00-1.777 1.704c-.444.642-.666 1.407-.666 2.296zM244.832 563.444h11.545v-15.111h5.773v15.111h14.21v5.334h-14.21v23.852c0 1.481.666 2.222 1.998 2.222h10.436v5.333h-12.508c-1.678 0-3.059-.543-4.145-1.629-1.036-1.087-1.554-2.47-1.554-4.149v-25.629h-11.545v-5.334zM329.744 582.259c0 3.062-.518 5.778-1.554 8.148-.987 2.321-2.319 4.297-3.997 5.926-1.677 1.581-3.651 2.79-5.92 3.63a19.524 19.524 0 01-6.957 1.259c-2.467 0-4.811-.42-7.031-1.259-2.221-.84-4.17-2.049-5.847-3.63-1.678-1.629-3.035-3.605-4.071-5.926-.987-2.37-1.48-5.086-1.48-8.148v-.889c0-3.012.493-5.679 1.48-8 1.036-2.37 2.393-4.37 4.071-6a17.623 17.623 0 015.921-3.703c2.22-.84 4.539-1.26 6.957-1.26 2.417 0 4.736.42 6.957 1.26a16.843 16.843 0 015.846 3.703c1.727 1.63 3.084 3.63 4.071 6 1.036 2.321 1.554 4.988 1.554 8v.889zm-18.428 13.482c1.776 0 3.404-.297 4.884-.889a11.79 11.79 0 003.997-2.741c1.135-1.185 2.023-2.592 2.664-4.222.642-1.679.962-3.556.962-5.63v-.889c0-1.975-.32-3.777-.962-5.407-.641-1.679-1.529-3.111-2.664-4.296a11.777 11.777 0 00-3.997-2.741 11.726 11.726 0 00-4.884-1.037c-1.727 0-3.356.346-4.885 1.037a11.777 11.777 0 00-3.997 2.741c-1.135 1.185-2.023 2.617-2.664 4.296-.641 1.63-.962 3.432-.962 5.407v.889c0 2.074.321 3.951.962 5.63.641 1.63 1.529 3.037 2.664 4.222a11.999 11.999 0 003.923 2.741c1.529.592 3.182.889 4.959.889zM342.052 563.444h13.322v4.889h.888c.938-2.024 2.27-3.506 3.997-4.444 1.727-.988 3.701-1.482 5.921-1.482 3.7 0 6.686 1.21 8.955 3.63 2.27 2.42 3.479 5.951 3.627 10.593l-6.069.889c0-3.408-.814-5.852-2.443-7.334-1.628-1.531-3.626-2.296-5.994-2.296-1.53 0-2.862.296-3.997.889a8.098 8.098 0 00-2.738 2.444c-.74 1.037-1.283 2.247-1.629 3.63-.345 1.383-.518 2.864-.518 4.444v15.556h9.326v5.333h-23.536v-5.333h8.438v-26.074h-7.55v-5.334zM419.786 593.963h-.888c-1.184 2.469-2.837 4.296-4.959 5.481-2.072 1.186-4.268 1.778-6.587 1.778-2.417 0-4.662-.395-6.735-1.185a16.308 16.308 0 01-5.476-3.63c-1.53-1.629-2.739-3.605-3.627-5.926-.888-2.321-1.332-5.012-1.332-8.074v-1.185c0-3.012.444-5.679 1.332-8 .888-2.321 2.097-4.271 3.627-5.852a15.818 15.818 0 015.476-3.703c2.073-.84 4.268-1.26 6.587-1.26 2.517 0 4.786.568 6.809 1.704 2.073 1.087 3.701 2.79 4.885 5.111h.888v-5.778h5.773v29.186c0 1.481.666 2.222 1.998 2.222h1.85v5.333h-3.922c-1.678 0-3.059-.543-4.145-1.629-1.036-1.087-1.554-2.47-1.554-4.149v-.444zm-11.842 1.778c1.727 0 3.306-.321 4.737-.963a10.5 10.5 0 003.775-2.741c1.036-1.185 1.85-2.593 2.442-4.222.592-1.679.888-3.531.888-5.556v-.889c0-1.975-.296-3.777-.888-5.407-.592-1.679-1.431-3.111-2.516-4.296a10.487 10.487 0 00-3.775-2.741c-1.431-.691-2.985-1.037-4.663-1.037-1.727 0-3.305.321-4.736.963a11.404 11.404 0 00-3.775 2.741c-1.036 1.135-1.85 2.543-2.442 4.222-.592 1.629-.888 3.432-.888 5.407v1.185c0 4.198 1.085 7.482 3.256 9.852 2.22 2.321 5.082 3.482 8.585 3.482zM470.062 594.556h-.888c-1.185 2.222-2.813 3.901-4.885 5.037-2.023 1.086-4.243 1.629-6.661 1.629-2.467 0-4.786-.42-6.957-1.259a17.59 17.59 0 01-5.773-3.63c-1.628-1.58-2.936-3.531-3.922-5.852-.938-2.37-1.407-5.061-1.407-8.074v-1.185c0-2.963.494-5.605 1.481-7.926.986-2.37 2.294-4.345 3.922-5.926a16.247 16.247 0 015.699-3.703 18.707 18.707 0 016.809-1.26c2.664 0 4.983.593 6.957 1.778 2.023 1.136 3.602 2.815 4.737 5.037h.888v-5.778h5.773v45.778c0 1.679-.543 3.062-1.629 4.148-1.036 1.087-2.393 1.63-4.07 1.63H446.23v-5.333h21.833c1.333 0 1.999-.741 1.999-2.223v-12.888zm-12.286 1.185c1.727 0 3.33-.321 4.811-.963a11.207 11.207 0 003.848-2.741c1.135-1.185 2.023-2.593 2.665-4.222.641-1.679.962-3.531.962-5.556v-.889c0-1.975-.321-3.777-.962-5.407-.642-1.679-1.53-3.111-2.665-4.296a11.03 11.03 0 00-3.922-2.741 11.064 11.064 0 00-4.737-1.037c-1.727 0-3.355.321-4.885.963a11.98 11.98 0 00-3.922 2.741c-1.086 1.185-1.949 2.592-2.591 4.222-.592 1.629-.888 3.432-.888 5.407v1.185c0 2.074.296 3.926.888 5.556.642 1.63 1.505 3.037 2.591 4.222a12.558 12.558 0 003.922 2.667c1.48.592 3.109.889 4.885.889zM495.396 583.593c.148 3.654 1.283 6.592 3.404 8.814 2.122 2.223 5.082 3.334 8.882 3.334 1.726 0 3.231-.198 4.514-.593 1.283-.395 2.369-.938 3.257-1.629.937-.692 1.677-1.482 2.22-2.371a13.55 13.55 0 001.406-2.963l5.477 1.482c-1.036 3.407-2.96 6.197-5.773 8.37-2.763 2.123-6.513 3.185-11.249 3.185-2.615 0-5.033-.444-7.253-1.333a16.749 16.749 0 01-5.625-3.926c-1.579-1.679-2.813-3.679-3.701-6-.888-2.321-1.332-4.889-1.332-7.704v-1.778c0-2.567.444-4.962 1.332-7.185.938-2.222 2.221-4.123 3.849-5.703a17.154 17.154 0 015.699-3.778c2.22-.938 4.613-1.408 7.179-1.408 3.009 0 5.6.568 7.771 1.704 2.22 1.087 4.021 2.445 5.402 4.074 1.431 1.63 2.467 3.408 3.109 5.334.691 1.925 1.036 3.703 1.036 5.333v4.741h-29.604zm12.286-15.704c-1.629 0-3.158.271-4.589.815a11.56 11.56 0 00-3.701 2.148 12.342 12.342 0 00-2.59 3.333c-.641 1.235-1.061 2.593-1.258 4.074h23.683c-.098-1.58-.493-3.012-1.184-4.296a9.846 9.846 0 00-2.59-3.259c-1.036-.889-2.245-1.581-3.627-2.074a11.826 11.826 0 00-4.144-.741z"
                      ></path>
                      <path
                        fill="#0576F0"
                        d="M351.606 502.037h14.802v14.815h-14.802v-14.815z"
                      ></path>
                    </g>
                  </g>
                  <defs>
                    <clipPath id="clip0_33_581">
                      <path fill="#fff" d="M0 0H720V1080H0z"></path>
                    </clipPath>
                    <clipPath id="clip1_33_581">
                      <path
                        fill="#fff"
                        d="M0 0H720V1080H0z"
                        transform="translate(0 -.196)"
                      ></path>
                    </clipPath>
                  </defs>
                </svg>
              </figure>
            </div>
          </div>

          <div className="w-1/2  lg:w-8/12 flex items-center justify-center bg-black md:w-full">
            <div className="md:text-center md:text-left md:p-5">
              <form>
                <h1 className="text-white text-md md:mb-2  md:mb-1 font-bold">
                  Log in/Sign up
                </h1>
                <p className="text-gray text-base">
                  Authenticate with your email to use the app.
                </p>
                <div className="flex mt-2 md:flex-wrap items-end mt-8 gap-0">
                  <Input
                    handleChange={change}
                    label={"Email Address"}
                    placeholder={"Your email..."}
                    className={`w-96 md:w-ful bg-gray-900 placeholder-label ou focus:outline-none focus:border-sky-500 focus:ring-sky-500 block rounded-base focus:ring-1 lg:w-80 min-h-sm font-mono font-medium text-sm pl-11 md:w-52 xs:w-full sm:w-52`}
                    valid={state.emailValid}
                    icon={
                      <svg
                        width="24"
                        height="24"
                        viewBox="0 0 24 24"
                        fill="none"
                        xmlns="http://www.w3.org/2000/svg"
                      >
                        <path
                          d="M7 9L10.7506 12.0005C11.481 12.5848 12.519 12.5848 13.2494 12.0005L17 9M21 17L21 7C21 5.89543 20.1046 5 19 5L5 5C3.89543 5 3 5.89543 3 7L3 17C3 18.1046 3.89543 19 5 19L19 19C20.1046 19 21 18.1046 21 17Z"
                          stroke="#596184"
                          strokeWidth="2"
                          strokeLinecap="round"
                          strokeLinejoin="round"
                        />
                      </svg>
                    }
                  />
                  <Button
                    type="button"
                    className="buttons w-52 bg-yellow h-sm font-bold rounded-base lg:px-8 px-8 text-sm  md:px-4 md:w-full md:mt-0 "
                    onClick={initLogin}
                  >
                    SIGN IN
                  </Button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </Page>
      {state.modalVisible && (
        <Modal>
          <div
            className={
              "modal-content shadow-lg relative flex flex-col w-full pointer-events-auto bg-[#B7006E] bg-clip-padding rounded-base outline-none text-current py-28"
            }
          >
            <div className="modal-header flex flex-shrink-0 items-center justify-center p-4  rounded-t-md ">
              <h5
                className="text-5xl  leading-normal text-white"
                id="exampleModalScrollableLabel "
              >
                Check your email
              </h5>
              <button
                type="button"
                className=" absolute top-5 right-5 box-content w-4 h-4 p-1 text-white border-none rounded-none  focus:shadow-none focus:outline-none focus:opacity-100 hover:text-white hover:opacity-75 hover:no-underline"
                onClick={cb(change, false)}
              >
                <img src="/images/Close.svg" alt={"close-icon"} />
              </button>
            </div>

            <div className="modal-body relative p-4 text-center text-white font-light font-mono text-xl">
              <p>
                We emailed a magic link to
                <br />
                <span className="font-mono font-semibold ">{state.email}</span>
                <br />
                Click the link to log in or sign up.
              </p>
            </div>
          </div>
        </Modal>
      )}
    </>
  );
};

export default Home;